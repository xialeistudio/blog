# 为什么淘宝移动版要把样式写到dom中

## 背景:

前几日，部门小伙伴问我为什么淘宝移动端的首页要把样式都写到dom里，而不把它们统一写到style标签里。如下图所示：

![淘宝首页源文件截图](https://raw.githubusercontent.com/yaojijiayou/blog/master/img/1.png)

同时甩给我一个知乎问题链接，知乎里的问题，就是小伙伴的问题。

我看了一下淘宝的首页，首先是不会加载外部的css文件，这是为了减少请求，很好理解。此外，一部分样式写在了style标签里，有一部分写到了dom里，写到style标签内很好理解，但为什么要把这么多的css样式写到dom里呢？

瞄了一眼知乎上寥寥无几的答案，有一位的答案是:"因为响应式,布局块宽高什么的,是根据视口宽度实时算出来的,所以就只能行内样式了吧"。

这个一看就有漏洞啊，如果单纯是为了响应式，只需要把width，height等样式写进去就行了，没必要把box-sizing,text-align这些属性也写到dom里去。而现实是他们把这些属性写到dom里去了，可以参看截图。于是和他撕了一下。


我开始自己思考，思考了一天半，想了几个答案，但是随着思考的深入，前面的通通被我否决，最终的答案是:

# 加快render tree的构建速度。

为什么这样写就能加快render树的构建呢？

因为这样减少样式匹配时间:
* 样式写在DOM中，因此css rule少了，所以为每个dom装载样式所需要遍历的css条目少了。
* 每条css rule的选择器路径变短，css rule匹配的时候从右至左，需要往复确定该css rule是否适用于某DOM。当选择器路径变短时，往复的次数也变少。



